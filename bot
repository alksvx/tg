import telebot

from pyowm import OWM
from pyowm.utils.config import get_default_config
import math
config_dict = get_default_config()
config_dict['language'] = 'ru'

owm = OWM('9a6caeec7afd17454724b45a068e3f37')
mgr = owm.weather_manager()

bot = telebot.TeleBot("5578516014:AAFDA76GER1o6w1fbEIlg2lWi9nLrL9D9qA")

@bot.message_handler(commands=['start'])
def welcome(message):
    bot.send_message(message.chat.id, "–ü—Ä–∏–≤–µ—Ç ü§ç. –ú–µ–Ω—è —Å–¥–µ–ª–∞–ª–∏, —á—Ç–æ–± —Ç—ã —É–∑–Ω–∞–ª –ø–æ–≥–æ–¥—É.\n–ù–∞–ø–∏—à–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–≤–æ–µ–≥–æ –≥–æ—Ä–æ–¥–∞ –∏ —è —Ç–µ–±–µ –ø–æ–º–æ–≥—É ü•∞")

@bot.message_handler(content_types=['text'])
def send_echo (message):
    observation = mgr.weather_at_place(message.text)
    w = observation.weather
    temp_max, temp_min, temp, feels_like = w.temperature('celsius')['temp_max'], w.temperature('celsius')['temp_min'], w.temperature('celsius')['temp'], w.temperature('celsius')['feels_like']
    city1 = message.text
    city = ''
    if city1[-1] in ('–∞, –æ, —ç, –µ, –∏, —ã, —É, —ë, —é, —è'):
        city = city1[:-1] + '–µ'
    elif city1[-1] in ('–±, –≤, –≥, –¥, –∂, –∑, –π, –∫, –ª, –º, –Ω, –ø, —Ä, —Å, —Ç, —Ñ, —Ö, —Ü, —á, —à, —â'):
        city = city1 + '–µ'

    answer = "–í " + city.title() + " " + w.detailed_status + '\n\n'
    answer += "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: " + str(int(round(temp, 0))) + "¬∞–°" + '\n'
    answer +="–ú–∞–∫—Å–∏–º—É–º: " + str(int(round(temp_max, 0))) + "¬∞–°" + ", –º–∏–Ω–∏–º—É–º: " + str(int(round(temp_min, 0))) + "¬∞–°" + '\n'
    answer += "–û—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫ " + str(int(round(feels_like, 0))) + "¬∞–°" + '\n\n'

    if temp < 0:
        answer += "–û–¥–µ–≤–∞–π—Ç–µ—Å—å —Ç–µ–ø–ª–µ–µ! –ù–∞ —É–ª–∏—Ü–µ —Ö–æ–ª–æ–¥–Ω–æ. ü•∂ –ù–µ –∑–∞–±—É–¥—å —Ç–µ—Ä–º–æ–±–µ–ª—å–µ"
    elif 0 < temp < 10:
        answer += "‚ùÑ –°–µ–π—á–∞—Å –ø—Ä–æ—Ö–ª–∞–¥–Ω–æ. –†–µ–∫–æ–º–µ–Ω–¥—É—é –Ω–∞–¥–µ—Ç—å —á—Ç–æ-—Ç–æ —Ç–µ–ø–ª–æ–µ"
    elif 10 < temp < 20:
        answer += "–ù–∞ —É–ª–∏—Ü–µ —Å–≤–µ–∂–æ! ‚òÅ –í–æ–∑—å–º–∏ —Å —Å–æ–±–æ–π –ª–µ–≥–∫—É—é –∫—É—Ä—Ç–∫—É –∏–ª–∏ —Å–≤–∏—Ç–µ—Ä"
    elif 20 < temp < 29:
        answer +="–°–µ–π—á–∞—Å –æ—á–µ–Ω—å —Ç–µ–ø–ª–æ!! üåû –ù–∞–¥–µ–≤–∞–π —à–æ—Ä—Ç—ã, —Ñ—É—Ç–±–æ–ª–∫—É –∏ —Å–∫–æ—Ä–µ–µ –≥—É–ª—è—Ç—å!"
    elif temp > 29:
        answer +="ü•µ–ö–∞–∫–∞—è –∂–∞—Ä–∞! –û–¥–µ–≤–∞–π—Å—è –ª–µ–≥–∫–æ –∏ –≤–æ–∑—å–º–∏ —Å —Å–æ–±–æ–π –±—É—Ç—ã–ª–∫—É –≤–æ–¥—ã –∏ –≥–æ–ª–æ–≤–Ω–æ–π —É–±–æ—Ä."
    bot.send_message(message.chat.id, answer)

bot.polling( none_stop = True)
